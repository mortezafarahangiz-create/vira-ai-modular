# ----------------------------------------------------
# Autodev Deployment Pipeline for VIRA-AI Backend Service
# ----------------------------------------------------
# This pipeline defines the steps for building and deploying the FastAPI service.

deployment:
  # The name of the service being deployed (must be unique within the project)
  serviceName: vira-ai-backend

  # Use the 'docker' strategy for containerized applications
  strategy: docker

  # Configuration for the build step using the Dockerfile
  build:
    # Specify the path to the Dockerfile (relative to the repository root)
    dockerfile: backend/Dockerfile
    # Specify the build context directory (where the Docker build command runs)
    context: backend/

  # Runtime configuration for the deployed container
  runtime:
    # Environment variables to be injected into the running container
    environment:
      # Load all key-value pairs from the production environment file
      envFile: backend/production.env
      
      # Health check configuration to ensure the service is running correctly
      healthCheck:
        # The path the health check should query
        path: /
        # The expected HTTP status code for a successful check
        expectedStatus: 200

    # Resource allocation (optional, but good practice)
    resources:
      cpu: 100m # 0.1 vCPU
      memory: 256Mi # 256 Megabytes of RAM
      
    # Port configuration
    ports:
      # Map the container port (8000, as defined in Dockerfile) to the external service port
      - containerPort: 8000
        servicePort: 80

    # Command to run the application (overrides CMD in Dockerfile if necessary, but here we keep it standard)
    # command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
